┌─────────────────────────────────────────────┐
│              [입력: 현재 상태 등]            │
│                                             │
│   current_state:     motion_state_t         │
│   target_pos:        vec3_t                 │
│   env:               environ_t*         │
│   body:              bodyprops_t*     │
│   config:            mpc_config_t*          │
└─────────────────────────────────────────────┘
                        │
                        ▼
          ┌────────────────────────────┐
          │  반복 루프 (max_iter만큼)   │
          └────────────────────────────┘
                        │
                        ▼
    ┌────────────────────────────────────┐
    │ 1. 가속도 후보 생성 (vec3_t accel) │◀────────────┐
    └────────────────────────────────────┘             │
                        │                             │
                        ▼                             │
    ┌────────────────────────────────────┐             │
    │ 2. 상태 복사                       │             │
    │    sim_state ← current_state       │             │
    └────────────────────────────────────┘             │
                        │                             │
                        ▼                             │
    ┌────────────────────────────────────────────┐    │
    │ 3. 시뮬레이션 루프 (horizon_sec / dt 반복) │    │
    │                                            │    │
    │   integrator_step(sim_state, dt)   │────┘
    └────────────────────────────────────────────┘
                        │
                        ▼
    ┌────────────────────────────────────┐
    │ 4. 비용 함수 평가 (Cost Function)  │
    │    → 목표에 가까운가?              │
    └────────────────────────────────────┘
                        │
                        ▼
    ┌────────────────────────────────────┐
    │ 5. 최소 비용 비교 / 업데이트       │
    │   if (cost < best_cost)           │
    │      → 저장                        │
    └────────────────────────────────────┘
                        │
                        ▼
          (반복 종료 후 최적 가속도 선택)
                        │
                        ▼
┌─────────────────────────────────────────────────────┐
│               [출력: 최적 제어 결과]                │
│                                                     │
│   mpc_output_t:                                     │
│     → desired_accel     (vec3_t)                    │
│     → future_target     (vec3_t, optional)          │
│     → cost               (float)                    │
└─────────────────────────────────────────────────────┘
